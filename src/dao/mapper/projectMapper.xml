<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.ProjectDao">

	<insert id="insertProject" parameterType="project">
		<selectKey order="BEFORE" keyProperty="pNum" resultType="int">
			select seq_project.nextval from dual
		</selectKey>
		insert into tbl_project
		(p_num, p_title, p_desc, p_start_date, p_end_date)
		values(#{pNum}, #{pTitle}, #{pDesc}, #{pStartDate, jdbcType=VARCHAR}, #{pEndDate, jdbcType=VARCHAR})
	</insert>
	
	<update id="updateProject" parameterType="project">
		update tbl_project
		set p_title = #{pTitle}, p_desc = #{pDesc}, p_start_date = #{pStartDate}, p_end_date = #{pEndDate}
		where p_num = #{pNum}
	</update>
	
	<delete id="deleteProject" parameterType="int">
		delete 
		from tbl_project
		where p_num = #{pNum}
	</delete>
	
	<select id="selectProjectByPNum" parameterType="int" resultMap="projectMap">
		select * 
		from tbl_project 
		where p_num = #{param1}
	</select>
	
	<select id="selectProjectByMNum" parameterType="int" resultMap="projectMap">
		select p.p_num, p.p_title, p.p_desc, p.p_start_date, p.p_end_date
		from tbl_project p join tbl_project_member pm
		on p.p_num = pm.p_num and pm.m_num = #{param1}
	</select>
	
	<resultMap id="projectMap" type="project">
		<result column="p_num" property="pNum" />
		<result column="p_title" property="pTitle" />
		<result column="p_desc" property="pDesc" />
		<result column="p_start_date" property="pStartDate" />
		<result column="p_end_date" property="pEndDate" />
	</resultMap>
</mapper>